# Creations E2E Test Flow Documentation

## Test Overview
This document defines the end-to-end test flow for the Kona Creations feature, testing the complete user journey from authentication to creation deployment.

## Test Environment
- **Target**: Development server (localhost:5001)
- **Test Type**: End-to-end automated test
- **Framework**: Vitest with Playwright-like browser automation
- **User**: Test user (testuser@example.com)

## Test Flow Steps

### 1. Authentication Phase
- **Step 1.1**: Navigate to login page
- **Step 1.2**: Enter test credentials (testuser@example.com / testpass123)
- **Step 1.3**: Verify successful login and redirect to dashboard
- **Step 1.4**: Verify user is authenticated

### 2. Navigation Phase
- **Step 2.1**: Navigate to creations page (/creations)
- **Step 2.2**: Verify creations page loads successfully
- **Step 2.3**: Verify "Create New" button is present

### 3. Creation Phase
- **Step 3.1**: Click "Create New" button
- **Step 3.2**: Fill creation form with test data:
  - **Title**: "Test Todo App"
  - **Description**: "A simple todo application with add, edit, delete, and mark complete functionality. Should have a clean modern interface with responsive design."
- **Step 3.3**: Submit creation form
- **Step 3.4**: Verify creation was created successfully
- **Step 3.5**: Verify creation appears in the list with "brainstorming" status

### 4. Planning Phase
- **Step 4.1**: Click "Generate Plan" button for the new creation
- **Step 4.2**: Wait for LLM to generate architecture plan
- **Step 4.3**: Verify plan generation completes successfully
- **Step 4.4**: Verify creation status changes to "approved"
- **Step 4.5**: Verify architecture plan content is displayed
- **Step 4.6**: Verify tasks are generated and visible in the UI

### 5. Validation Phase
- **Step 5.1**: Verify creation has expected properties:
  - Valid deployment URL format
  - Proper status progression
  - Architecture plan content
  - Task breakdown with subtasks
- **Step 5.2**: Test creation actions:
  - View creation details
  - Check task list
  - Verify progress tracking

### 6. Cleanup Phase
- **Step 6.1**: Delete the test creation
- **Step 6.2**: Verify deletion was successful
- **Step 6.3**: Verify creation no longer appears in list

## Expected Outputs

### Creation Object Structure
```javascript
{
  id: number,
  title: "Test Todo App",
  description: "A simple todo application...",
  status: "brainstorming" | "planning" | "approved" | "building" | "completed",
  pageName: "test-todo-app",
  deploymentUrl: "https://pages.orenslab.com/test-todo-app",
  architecturePlan: string, // Generated by LLM
  totalTasks: number,
  totalSubtasks: number,
  userId: 5,
  createdAt: string,
  updatedAt: string
}
```

### Architecture Plan Sample
The generated architecture plan should include:
- High-level architecture overview
- Technology stack recommendations  
- Component breakdown
- Data flow patterns
- Implementation considerations

### Task Breakdown Sample
```javascript
[
  {
    title: "Project Setup",
    description: "Initialize project structure and dependencies",
    category: "setup",
    estimatedDuration: "1h",
    subtasks: [
      {
        title: "Create project structure",
        description: "Set up folders and basic files",
        estimatedDuration: "15m",
        filesPaths: ["package.json", "index.html", "src/"]
      }
    ]
  },
  // ... more tasks
]
```

## Test Assertions

### API Endpoints to Test
1. `POST /api/creations` - Create new creation
2. `GET /api/creations` - List user creations
3. `GET /api/creations/:id` - Get specific creation
4. `POST /api/creations/:id/plan` - Generate architecture plan
5. `DELETE /api/creations/:id` - Delete creation

### UI Elements to Verify
1. Creation form fields and validation
2. Status badges and progress indicators
3. Architecture plan display
4. Task list rendering
5. Action buttons (Create, Plan, Delete)

### Error Scenarios to Test
1. Invalid form data submission
2. Network errors during plan generation
3. Authentication failures
4. Missing creation data

## Test Data
- **Test User**: testuser@example.com (ID: 5)
- **Test Creation Title**: "Test Todo App"
- **Test Description**: "A simple todo application with add, edit, delete, and mark complete functionality. Should have a clean modern interface with responsive design."
- **Expected Page Name**: "test-todo-app" (or with numeric suffix for uniqueness)

## Success Criteria
- All API calls return expected status codes
- Creation progresses through proper status transitions
- LLM generates valid architecture plan and task breakdown
- UI correctly displays all creation data
- No console errors or unhandled exceptions
- Test completes within reasonable time (< 60 seconds)

## Failure Scenarios
- "Failed to create creation" error during initial creation
- LLM timeout or error during plan generation
- Database constraint violations
- Authentication or authorization failures
- UI rendering errors or missing elements

## Notes
- Test should be idempotent and can be run multiple times
- Use unique identifiers where possible to avoid conflicts
- Clean up test data after each run
- Mock external dependencies if needed for reliability
- Log detailed information for debugging failures